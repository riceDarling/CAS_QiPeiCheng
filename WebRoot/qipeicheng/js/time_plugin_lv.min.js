$(document).ready(function() {
	var this_lv = "";
	//
	var date_lv = new Date();
	var Year_lv = date_lv.getFullYear();
	var month_lv = (date_lv.getMonth() + 1);
	var month_day = date_lv.getDate();
	// 
	var html = "";
	html += '<div class="time_plugin_lv">';
	html += '<div class="time_plugin_top_lv">';
	html += '<div><i time_plugin_mun_lv="-1"><img src="img/tri_left.png"/></i><span>' + Year_lv + '年</span><i time_plugin_mun_lv="1"><img src="img/tri_right.png"/></i></div>';
	html += '<div class="time_plugin_top_right_lv"><i time_plugin_mun_lv="-1"><img src="img/tri_left.png"/></i><span>' + month_lv + '月</span><i time_plugin_mun_lv="1"><img src="img/tri_right.png"/></i></div>';
	html += '</div>';
	html += '<ul class="time_plugin_week_lv"><li>日</li><li>一</li><li>二</li><li>三</li><li>四</li><li>五</li><li>六</li></ul>';
	html += '<ul class="time_plugin_day_lv"></ul>';
	html += '<div class="time_plugin_bottom_lv"><a><select></select></a>:<a><select></select></a>:<a><select></select></a></div>';
	html += '</div>';
	html += '<div class="time_plugin_background_lv"></div>';
	if($(".time_plugin_lv").length == 0) {
		$("body").append(html);
	}
	for(shi = 0; shi < 24; shi++) {
		if(shi < 10) {
			html = "<option value='0" + shi + "'>0" + shi + "</option>";
		} else {
			html = "<option value=" + shi + ">" + shi + "</option>";
		}
		$(".time_plugin_lv .time_plugin_bottom_lv a:eq(0) select").append(html);
	};
	for(fen = 0; fen < 60; fen++) {
		if(fen < 10) {
			html = "<option value='0" + fen + "'>0" + fen + "</option>";
		} else {
			html = "<option value=" + fen + ">" + fen + "</option>";
		}
		$(".time_plugin_lv .time_plugin_bottom_lv a:eq(1) select,.time_plugin_lv .time_plugin_bottom_lv a:eq(2) select").append(html);
	};
	//
	$(document).on("click", ".time_plugin_lv_onclick", function() {
		this_lv = $(this);
		$(".time_plugin_background_lv").height($(document).height() + "px");
		if($(window).height() - $(this_lv).offset().top > 341) {
			$(".time_plugin_lv").css({
				"top": $(this_lv).offset().top + $(this_lv).height()
			});
		} else {
			$(".time_plugin_lv").css({ 
				"top": $(this_lv).offset().top - 300
			});
		}
		
		if($(window).width() - $(this_lv).offset().left > 220) {
			$(".time_plugin_lv").css({
				"left": $(this_lv).offset().left
			});
		} else {
			$(".time_plugin_lv").css({
				"right": 10
			});
		}
		time_plugin();
	});
	//
	function time_plugin() {
		Year_lv = $(".time_plugin_lv .time_plugin_top_lv div:eq(0) span").text().split("年")[0];
		month_lv = $(".time_plugin_lv .time_plugin_top_lv div:eq(1) span").text().split("月")[0];
		$(".time_plugin_lv .time_plugin_day_lv").html("");
		var html = "";
		var week_index = new Date(Year_lv, month_lv - 1, 1).getDay();
		var day_index2 = "";
		if(month_lv != 1) {
			day_index2 = new Date(Year_lv, month_lv - 1, 0).getDate();
		} else {
			day_index2 = new Date(Year_lv, 11, 0).getDate();
		};
		for(var i = (day_index2 - week_index + 1); i < (day_index2 + 1); i++) {
			html += "<li>" + i + "</li>"
		};
		var day_index = new Date(Year_lv, month_lv, 0).getDate();
		for(var i = 0; i < day_index; i++) {
			week_index = new Date(Year_lv, month_lv - 1, (i + 1)).getDay();
			html += "<li class='time_plugin_lv_click' value_plugin_lv=" + Year_lv + "/" + month_lv + "/" + (i + 1) + " value_plugin_lv2=" + Year_lv + "-" + month_lv + "-" + (i + 1) + " text_plugin_lv=" + Year_lv + "年" + month_lv + "月" + (i + 1) + "日" + "星期" + week_index + ">" + (i + 1) + "</li>"
		};
		$(".time_plugin_lv .time_plugin_day_lv").append(html);
		if($(".time_plugin_lv .time_plugin_day_lv li").length != 42) {
			html = "";
			for(var i = 0; i < (42 - $(".time_plugin_lv .time_plugin_day_lv li").length); i++) {
				html += "<li>" + (i + 1) + "</li>";
			};
			$(".time_plugin_lv .time_plugin_day_lv").append(html);
		};
	};
	//
	$(document).on("click", ".time_plugin_lv .time_plugin_top_lv div:eq(0) i:eq(0),.time_plugin_lv .time_plugin_top_lv div:eq(0) i:eq(1)", function() {
		var time_plugin_mun_lv = $(this).attr("time_plugin_mun_lv");
		Year_lv = $(".time_plugin_lv .time_plugin_top_lv div:eq(0) span").text().split("年")[0];
		if(Year_lv == 1 && time_plugin_mun_lv == "-1") {
			$(".time_plugin_lv .time_plugin_top_lv div:eq(0) span").text(Year_lv + "年");
		} else {
			$(".time_plugin_lv .time_plugin_top_lv div:eq(0) span").text(Year_lv * 1 + time_plugin_mun_lv * 1 + "年")
		};
		time_plugin();
	});
	$(document).on("click", ".time_plugin_lv .time_plugin_top_lv div:eq(1) i:eq(0),.time_plugin_lv .time_plugin_top_lv div:eq(1) i:eq(1)", function() {
		var time_plugin_mun_lv = $(this).attr("time_plugin_mun_lv");
		month_lv = $(".time_plugin_lv .time_plugin_top_lv div:eq(1) span").text().split("月")[0];
		if(month_lv == 12 && time_plugin_mun_lv == "1") {
			$(".time_plugin_lv .time_plugin_top_lv div:eq(1) span").text("1月");
		} else if(month_lv == 1 && time_plugin_mun_lv == "-1") {
			$(".time_plugin_lv .time_plugin_top_lv div:eq(1) span").text("12月");
		} else {
			$(".time_plugin_lv .time_plugin_top_lv div:eq(1) span").text(month_lv * 1 + time_plugin_mun_lv * 1 + "月");
		};
		time_plugin();
	});
	//
	$(document).on("click", ".time_plugin_lv_click", function() {
		var this_text_lv = "";
		if($(this_lv).attr("time_plugin_lv_type") == 1) {
			this_text_lv = $(this).attr("value_plugin_lv");
		} else if($(this_lv).attr("time_plugin_lv_type") == 2) {
			this_text_lv = $(this).attr("value_plugin_lv2");
		} else if($(this_lv).attr("time_plugin_lv_type") == 3) {
			this_text_lv = $(this).attr("text_plugin_lv");
		};
		if($(this_lv)[0].tagName != "INPUT") {
			$(this_lv).text(this_text_lv);
		} else {
			$(this_lv).val(this_text_lv + " " + $(".time_plugin_lv .time_plugin_bottom_lv a:eq(0) select").val() + ":" + $(".time_plugin_lv .time_plugin_bottom_lv a:eq(1) select").val() + ":" + $(".time_plugin_lv .time_plugin_bottom_lv a:eq(2) select").val());
		};
	});
	//
	var this_show = 0;

	function this_show_lv() {
		 date_lv = new Date();
		 Year_lv = date_lv.getFullYear();
		 month_lv = (date_lv.getMonth() + 1);
		 month_day = date_lv.getDate();
		// 
		var html_a = "";
		html_a += '<div class="time_plugin_top_lv">';
		html_a += '<div><i time_plugin_mun_lv="-1"><img src="img/tri_left.png"/></i><span>' + Year_lv + '年</span><i time_plugin_mun_lv="1"><img src="img/tri_right.png"/></i></div>';
		html_a += '<div class="time_plugin_top_right_lv"><i time_plugin_mun_lv="-1"><img src="img/tri_left.png"/></i><span>' + month_lv + '月</span><i time_plugin_mun_lv="1"><img src="img/tri_right.png"/></i></div>';
		html_a += '</div>';
		html_a += '<ul class="time_plugin_week_lv"><li>日</li><li>一</li><li>二</li><li>三</li><li>四</li><li>五</li><li>六</li></ul>';
		html_a += '<ul class="time_plugin_day_lv"></ul>';
		html_a += '<div class="time_plugin_bottom_lv"><a><select></select></a>:<a><select></select></a>:<a><select></select></a></div>';
		$(".time_plugin_lv").html(html_a);
		for(shi = 0; shi < 24; shi++) {
			if(shi < 10) {
				html = "<option value='0" + shi + "'>0" + shi + "</option>";
			} else {
				html = "<option value=" + shi + ">" + shi + "</option>";
			}
			$(".time_plugin_lv .time_plugin_bottom_lv a:eq(0) select").append(html);
		};
		for(fen = 0; fen < 60; fen++) {
			if(fen < 10) {
				html = "<option value='0" + fen + "'>0" + fen + "</option>";
			} else {
				html = "<option value=" + fen + ">" + fen + "</option>";
			}
			$(".time_plugin_lv .time_plugin_bottom_lv a:eq(1) select,.time_plugin_lv .time_plugin_bottom_lv a:eq(2) select").append(html);
		};
		time_plugin();
		if(this_show == 0) {
			$(".time_plugin_lv").show();
			$(".time_plugin_background_lv").show();
			this_show = 1;
			return;
		} else {
			$(".time_plugin_lv").hide();
			$(".time_plugin_background_lv").hide();
			this_show = 0;
			return;
		};
	};
	$(document).on("click", ".time_plugin_lv_onclick,.time_plugin_background_lv,.time_plugin_lv_click", function() {
		this_lv = $(this);
		this_show_lv();
		return;
	});
});